# PPT内容扩展智能体 环境配置指南
环境配置需完成系统依赖安装、Python环境搭建、配置文件设置、Docker服务部署四步，全程约15-30分钟，支持Linux/macOS/Windows（WSL2）系统。

## 一、前置依赖准备
1. 操作系统要求：Linux（Ubuntu 20.04+/CentOS 8+）、Windows 10+（需启用WSL2）。
2. 硬件要求：4GB以上内存，支持Docker容器运行（推荐8GB+内存以保证向量数据库性能）。
3. 必须安装软件：
   - Git：用于拉取代码（可选，直接下载源码可跳过）。
   - Docker：版本20.10+，用于运行Redis、PostgreSQL、Milvus等依赖服务。
   - Docker Compose：版本2.0+，用于编排多容器服务。
   - Python：版本3.8-3.10（推荐3.9），需配置pip环境。

## 二、Python环境配置
1. 创建虚拟环境（推荐）：
   ```bash
   # 创建虚拟环境
   python -m venv ppt-agent-env
   # 激活环境（Linux/macOS）
   source ppt-agent-env/bin/activate
   # 激活环境（Windows）
   ppt-agent-env\Scripts\activate
   ```
2. 安装依赖包：
   将项目中的`requirements.txt`文件放在工作目录，执行以下命令：
   ```bash
   pip install -r requirements.txt
   ```
   依赖说明：包含FastAPI（API服务）、Streamlit（Web界面）、python-pptx（PPT解析）、pymilvus（向量数据库连接）等核心库，安装时确保网络通畅，超时可重试。

## 三、配置文件设置
1. 复制环境变量模板：
   项目根目录创建`.env`文件，复制以下内容并修改关键配置：
   ```env
   # 硅基流动API配置（必填）
   SILICONFLOW_API_KEY=你的硅基流动API密钥
   SILICONFLOW_BASE_URL=https://api.siliconflow.cn/v1
   SILICONFLOW_MODEL=deepseek-ai/DeepSeek-V3.2-Exp
   # 应用配置
   DEBUG=True
   UPLOAD_FOLDER=uploads
   MAX_UPLOAD_SIZE=104857600
   # 向量数据库配置（默认无需修改，Docker部署时自动匹配）
   MILVUS_HOST=milvus-standalone
   MILVUS_PORT=19530
   MILVUS_COLLECTION=ppt_content
   MILVUS_EMBEDDING_DIM=384
   # 数据库配置（默认无需修改）
   REDIS_URL=redis://redis:6379/0
   POSTGRES_URL=postgresql://admin:admin123@postgres:5432/ppt_agent
   ```
2. 关键配置说明：
   - `SILICONFLOW_API_KEY`：需从硅基流动平台申请，是AI内容扩展的核心密钥。
   - 其他配置保持默认即可，Docker部署时会自动映射服务地址和端口。

## 四、Docker服务部署
1. 确保Docker服务已启动：
   - Linux：执行`sudo systemctl start docker`（或通过应用图标启动）。
   - Windows：启动Docker Desktop并等待服务就绪。
2. 启动依赖服务：
   进入项目根目录（包含`docker-compose.yml`文件），执行以下命令：
   ```bash
   # 后台启动所有服务（Redis、PostgreSQL、Milvus等）
   docker-compose up -d
   ```
3. 验证服务状态：
   执行`docker-compose ps`，确保所有服务状态为`Up`（Milvus启动较慢，可能需要1-2分钟）。
   - Redis：端口6379，用于缓存。
   - PostgreSQL：端口5432，用于存储文件元数据。
   - Milvus：端口19530（向量搜索）、9091（健康检查）。

## 五、系统启动与验证
1. 启动主服务：
   在Python虚拟环境中执行以下命令，同时启动API服务和Web界面：
   ```bash
   python main.py --mode web
   ```
2. 验证访问：
   - Web界面：浏览器访问`http://localhost:8501`，能看到登录/上传页面即成功。
   - API健康检查：访问`http://localhost:8010/health`，返回`{"status": "healthy"}`即正常。
3. 常见问题排查：
   - 服务启动失败：检查Docker服务是否全部正常运行，查看日志`docker-compose logs -f`。
   - 依赖安装报错：确保Python版本符合要求，升级pip`pip install --upgrade pip`后重试。
   - API密钥错误：检查`.env`文件中`SILICONFLOW_API_KEY`是否正确，无空格或多余字符。

## 六、可选配置（进阶）
1. 端口冲突解决：
   若默认端口（8010、8501、6379等）被占用，修改`docker-compose.yml`中对应服务的`ports`映射（如`"8011:8010"`），同时更新`.env`文件中对应端口配置。
2. 数据持久化：
   默认数据存储在Docker卷中，如需备份，可修改`docker-compose.yml`中`volumes`配置，映射到本地目录（如`./postgres-data:/var/lib/postgresql/data`）。
